<script type="text/javascript">
  const TypeSheetDB = new Vue({
    el: '#typesheet-db',
    data: {
     newTable: {
       name: '',
       columns: []
     },
     tables: [],
     currentView: 'home',
     //TODO: rename to activeSheet
     selectedSheet: ''
    },
    methods: {
     changeView(route, activeSheet) {
      this.currentView = route
      if (route === 'home') {
        google.script.run.withSuccessHandler(this.getAllTablesSuccess).getAllTables()
      } 
      if (route === 'edit' || route === 'delete' || route === 'import') {
        this.selectedSheet = activeSheet
        google.script.run.setActiveTable(activeSheet)
      }
     },
     addColumnToNewTable: function () {
       let newColumn = {
         name: '',
         type: '',
         state: 'editing'
        }
        this.newTable.columns.push(newColumn)
     },
     addTable: function () {
       google.script.run.withSuccessHandler(this.onSuccess).addTableToSpreadsheet(this.newTable)
     },
     deleteTable: function (sheet) {
       google.script.run.withSuccessHandler(this.onSuccess).deleteTable(sheet)
     },
     loadExistingDataModel: function (data) {
       console.log(data)
       this.dataModel = data
     },
     getAllTablesSuccess: function (data) {
       console.log(data)
       this.sheets = data
     },
     onSuccess: function (response) {
       console.log(response)
       if (response.updateVue === true) {
        for(key in response.data) {
          this[key] = response.data[key]
        }
       }

       if(response.changeView && response.changeView !== null){
        this.changeView(response.changeView)
       }

      M.toast({html: response.message})
     }
    },
    computed: {
    },
    created: function () {
      google.script.run.withSuccessHandler(this.onSuccess).callUiService('getAllTables')
    }
  })
 </script>